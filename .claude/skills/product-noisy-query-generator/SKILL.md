---
name: product-noisy-query-generator
description: è¯»å– clean_queries.csv æ–‡ä»¶ï¼ŒåŸºäºç”¨æˆ·å†™ä½œé£æ ¼é”™è¯¯ç»Ÿè®¡ï¼Œå¼•å¯¼ Agent æ‰‹åŠ¨é€ä¸ªç”Ÿæˆå¸¦å™ªéŸ³ï¼ˆæ‹¼å†™/è¯­æ³•é”™è¯¯ï¼‰çš„æŸ¥è¯¢ã€‚
allowed-tools: run_command, view_file, ask_user_question
---

# Product-Noisy-Query-Generator

æ­¤æŠ€èƒ½ç”¨äºå¼•å¯¼ Agent å°†å¹²å‡€çš„å•†å“æŸ¥è¯¢ï¼ˆ`clean_queries.csv`ï¼‰è½¬åŒ–ä¸ºå¸¦æœ‰ç‰¹å®šç”¨æˆ·é£æ ¼é”™è¯¯çš„"å™ªéŸ³æŸ¥è¯¢"ã€‚

## ğŸš¨ æ ¸å¿ƒåŸåˆ™

1. **é€ä¸ªæ‰‹åŠ¨å¤„ç†**ï¼šè™½ç„¶æœ‰Pythonè„šæœ¬ä½œä¸ºé€»è¾‘è¾…åŠ©ï¼Œä½†è¦æ±‚ Agent **é€è¡Œè¯»å–** CSVï¼Œ**è°ƒç”¨è¾…åŠ©è„šæœ¬**è·å–å»ºè®®ï¼Œç„¶å**æ‰‹åŠ¨ç¡®è®¤**æœ€ç»ˆè¾“å‡ºã€‚ä¸¥ç¦ç›²ç›®æ‰¹é‡è¿è¡Œè„šæœ¬è¦†ç›–æ–‡ä»¶ã€‚
2. **åŸºäºçœŸå®é”™è¯¯æ•°æ®**ï¼šå¿…é¡»ä½¿ç”¨ `error_stats_{USER_ID}.json` ä¸­çš„é‡åŒ–é”™è¯¯ç»Ÿè®¡æ•°æ®ä½œä¸ºæƒé‡å€¼ã€‚
3. **ç»“æœå¯è§£é‡Šæ€§**ï¼šå¯¹äºæ¯ä¸€ä¸ªæ”¹å†™ï¼ŒAgent åº”è¯¥çŸ¥é“æ˜¯åŸºäºå“ªä¸ªé”™è¯¯ç±»å‹ï¼ˆError Typeï¼‰å’Œæƒé‡ï¼ˆWeightï¼‰è¿›è¡Œçš„ã€‚
4. **âš ï¸ å•é”™è¯¯é™åˆ¶**ï¼šæ¯ä¸ªå¥å­**åªå…è®¸æ³¨å…¥ä¸€ä¸ªé”™è¯¯**ã€‚å³ä½¿è¯†åˆ«å‡ºå¤šä¸ªè§¦å‘å™¨ï¼Œä¹Ÿåªèƒ½åº”ç”¨æƒé‡æœ€é«˜çš„é‚£ä¸€ä¸ªï¼Œé¿å…è¿‡åº¦æ”¹å†™å¯¼è‡´ä¸è‡ªç„¶ã€‚

## ğŸ“Š æƒé‡è®¡ç®—é€»è¾‘

è„šæœ¬ä½¿ç”¨ç”¨æˆ·å†™ä½œåˆ†æä¸­çš„é”™è¯¯ç»Ÿè®¡æ–‡ä»¶æ¥åŠ¨æ€è®¡ç®—æ¯ç§é”™è¯¯ç±»å‹çš„æƒé‡ï¼š

**1. é”™è¯¯ç±»å‹æƒé‡å…¬å¼ï¼š**
```
weight = 0.3 + (error_count / total_errors_in_category) Ã— 0.6
æœ€å¤§æƒé‡ = 0.95
```

**2. åŠ¨æ€é£é™©é˜ˆå€¼ï¼ˆåŸºäºé”™è¯¯ç‡ï¼‰ï¼š**
```
threshold = 0.5 / (1 + errors_per_100_words)
```

è¿™ä¸ªå…¬å¼ç¡®ä¿ï¼š
- **é«˜é”™è¯¯ç‡ç”¨æˆ·** â†’ é˜ˆå€¼é™ä½ â†’ æ›´å®¹æ˜“è§¦å‘æ”¹å†™ï¼ˆç¬¦åˆå…¶çœŸå®å†™ä½œä¹ æƒ¯ï¼‰
- **ä½é”™è¯¯ç‡ç”¨æˆ·** â†’ é˜ˆå€¼æé«˜ â†’ æ›´éš¾è§¦å‘æ”¹å†™ï¼ˆä¿æŒå…¶å†™ä½œè´¨é‡ï¼‰

**ç¤ºä¾‹ï¼š**
- ç”¨æˆ·é”™è¯¯ç‡ 0.45/100è¯ â†’ é˜ˆå€¼ = 0.5 / 1.45 = **0.34**
- ç”¨æˆ·é”™è¯¯ç‡ 1.50/100è¯ â†’ é˜ˆå€¼ = 0.5 / 2.50 = **0.20**ï¼ˆæ›´å®¹æ˜“æ”¹å†™ï¼‰
- ç”¨æˆ·é”™è¯¯ç‡ 0.10/100è¯ â†’ é˜ˆå€¼ = 0.5 / 1.10 = **0.45**ï¼ˆæ›´éš¾æ”¹å†™ï¼‰

**æ³¨**ï¼šåŸºç¡€é˜ˆå€¼è®¾ä¸º 0.5ï¼ˆè€Œé 0.7ï¼‰æ˜¯ä¸ºäº†åœ¨ä¿è¯è´¨é‡çš„å‰æä¸‹ï¼Œè®©çº¦ 50-60% çš„å¥å­è¢«æ ‡è®°ä¸º HIGH RISKã€‚

**ç¤ºä¾‹è®¡ç®—ï¼ˆåŸºäºç”¨æˆ· AG7EF0SVBQOUXï¼‰ï¼š**

æ‹¼å†™é”™è¯¯ï¼ˆå…±12ä¸ªï¼‰ï¼š
- Extra Space: 3ä¸ª â†’ weight = 0.3 + (3/12)Ã—0.6 = **0.45**
- Homophone: 2ä¸ª â†’ weight = 0.3 + (2/12)Ã—0.6 = **0.40**
- Scramble: 2ä¸ª â†’ weight = **0.40**
- Substitution: 2ä¸ª â†’ weight = **0.40**
- Hard Word: 2ä¸ª â†’ weight = **0.40**
- Insertion: 1ä¸ª â†’ weight = 0.3 + (1/12)Ã—0.6 = **0.35**

è¯­æ³•é”™è¯¯ï¼ˆå…±24ä¸ªï¼‰ï¼š
- Agreement: 9ä¸ª â†’ weight = 0.3 + (9/24)Ã—0.6 = **0.525**
- Hyphenation: 5ä¸ª â†’ weight = 0.3 + (5/24)Ã—0.6 = **0.425**
- Preposition: 4ä¸ª â†’ weight = 0.3 + (4/24)Ã—0.6 = **0.40**
- Suffix: 3ä¸ª â†’ weight = 0.3 + (3/24)Ã—0.6 = **0.375**
- Collocation: 3ä¸ª â†’ weight = **0.375**

**æ˜ å°„åˆ°å…·ä½“é”™è¯¯æ¨¡å¼ï¼š**

| é”™è¯¯ç±»å‹ | æƒé‡ | è§¦å‘è¯/æ¨¡å¼ | æ”¹å†™åŠ¨ä½œ |
|---------|------|-----------|---------|
| **Extra Space** | 0.45 | `intact` â†’ `in tact` | æ‹†åˆ†å•è¯ |
| **Homophone** | 0.40 | `palette` â†’ `pallet`, `their` â†’ `there` | æ›¿æ¢ä¸ºåŒéŸ³è¯ |
| **Scramble** | 0.40 | `individual` â†’ `invididual`, `Albrecht` â†’ `Albrect` | æ‰“ä¹±å­—æ¯é¡ºåº |
| **Substitution** | 0.40 | `These` â†’ `Theses` | æ›¿æ¢ä¸ºç›¸ä¼¼è¯ |
| **Insertion** | 0.35 | `obsessed` â†’ `obssessed` | æ’å…¥å¤šä½™å­—æ¯ |
| **Hard Word** | 0.40 | `Fuchsia` â†’ `Fuschia`, `Zieman` â†’ `Zeimen` | æ‹¼å†™éš¾è¯ |
| **Agreement** | 0.525 | å¤æ•°ä¸»è¯­ + `are/do/have` â†’ æ”¹ä¸º `is/does/has` | ä¸»è°“ä¸ä¸€è‡´ |
| **Hyphenation** | 0.425 | `high-end` â†’ `high end`, `off-white` â†’ `off white` | åˆ é™¤è¿å­—ç¬¦ |
| **Preposition** | 0.40 | `which/that + is/are` â†’ åˆ é™¤ `is/are` | åˆ é™¤ç³»åŠ¨è¯ |
| **Suffix** | 0.375 | `more fine` â†’ `more finer`, `using` â†’ `using` (in "to using") | è¯å½¢é”™è¯¯ |
| **Collocation** | 0.375 | `because/so/but + pronoun + verb` â†’ åˆ é™¤åä¸¤éƒ¨åˆ† | åˆ é™¤è¿è¯åæˆåˆ† |

## æ‰§è¡Œæµç¨‹

### é˜¶æ®µ 1ï¼šå‡†å¤‡è¾“å‡ºæ–‡ä»¶

```bash
# ç¡®ä¿ç›®å½•å­˜åœ¨
mkdir -p /home/wlia0047/ar57/wenyu/result/noisy_query

# åˆ›å»ºä¸€ä¸ªæ–°çš„CSVæ–‡ä»¶ç”¨äºå­˜å‚¨å™ªéŸ³æŸ¥è¯¢ï¼Œåªå†™å…¥header
echo "id,original_query,noisy_query,answer_ids_source" > /home/wlia0047/ar57/wenyu/result/noisy_query/noisy_queries.csv
```

### é˜¶æ®µ 2ï¼šç”Ÿæˆä»»åŠ¡æè¿°æ–‡ä»¶ (Task Generation)

è¿è¡Œ `generate_noisy_tasks.py` è„šæœ¬ï¼Œå®ƒä¼šï¼š
1. è¯»å–ç”¨æˆ·é”™è¯¯ç»Ÿè®¡æ–‡ä»¶
2. è®¡ç®—æ¯ç§é”™è¯¯ç±»å‹çš„æƒé‡
3. é¢„è®¡ç®—æ‰€æœ‰å¥å­çš„é£é™©åˆ†æ•°
4. ç”ŸæˆåŒ…å« Prompt çš„ä»»åŠ¡åˆ—è¡¨

```bash
python3 /home/wlia0047/ar57/wenyu/.claude/skills/product-noisy-query-generator/generate_noisy_tasks.py \
    --input /home/wlia0047/ar57/wenyu/result/clean_query/clean_queries.csv \
    --output /home/wlia0047/ar57/wenyu/result/noisy_query/noisy_query_tasks.json \
    --stats /home/wlia0047/ar57/wenyu/result/writing_analysis/error_stats_AG7EF0SVBQOUX.json
```

**è„šæœ¬è¾“å‡ºç¤ºä¾‹ï¼š**
```
Loading error statistics from error_stats_AG7EF0SVBQOUX.json...

ğŸ“ Spelling Error Weights:
  - Extra Space: 3 errors â†’ weight = 0.45
  - Homophone: 2 errors â†’ weight = 0.40
  - Scramble: 2 errors â†’ weight = 0.40
  - Substitution: 2 errors â†’ weight = 0.40
  - Insertion: 1 errors â†’ weight = 0.35
  - Hard Word: 2 errors â†’ weight = 0.40

ğŸ“ Grammar Error Weights:
  - Agreement: 9 errors â†’ weight = 0.525
  - Hyphenation: 5 errors â†’ weight = 0.425
  - Preposition: 4 errors â†’ weight = 0.40
  - Suffix: 3 errors â†’ weight = 0.375
  - Collocation: 3 errors â†’ weight = 0.375

âœ… Statistics loaded: 12 spelling errors, 24 grammar errors
   Total error rate: 0.45 per 100 words
   Original threshold: 0.50
   Adjusted threshold: 0.34 (based on error rate 0.45)

ğŸ“‚ Reading queries from clean_queries.csv...
âœ… Generated 101 tasks.
ğŸ“ Saved to noisy_query_tasks.json
```

### é˜¶æ®µ 3ï¼šé€ä¸ªæ‰§è¡Œæ”¹å†™ä»»åŠ¡ (Execution)

ğŸ”´ **è¯·è¯»å–ç”Ÿæˆçš„ `noisy_query_tasks.json`ï¼Œå¹¶é€ä¸ªå¤„ç†ï¼š**

**å¯¹äºæ¯ä¸ªä»»åŠ¡ï¼š**

1. **è¯»å–ä»»åŠ¡è¯¦æƒ…**ï¼š
   - `original_query`: åŸå§‹æŸ¥è¯¢
   - `difficulty_score`: é£é™©åˆ†æ•°
   - `risk_status`: HIGH RISK (>=åŠ¨æ€é˜ˆå€¼) æˆ– LOW RISK (<åŠ¨æ€é˜ˆå€¼)
   - `triggers_detail`: è¯†åˆ«åˆ°çš„è§¦å‘å™¨åŠæƒé‡
   - `machine_suggestion`: æœºå™¨å»ºè®®çš„å™ªéŸ³ç‰ˆæœ¬

2. **æ‰§è¡Œæ”¹å†™ï¼ˆâš ï¸ æ¯å¥åªå…è®¸ä¸€ä¸ªé”™è¯¯ï¼‰**ï¼š
   - **HIGH RISK**ï¼š
     - æŸ¥çœ‹ `triggers_detail` ä¸­æƒé‡æœ€é«˜çš„è§¦å‘å™¨
     - **åªåº”ç”¨è¿™ä¸€ä¸ªè§¦å‘å™¨**ï¼Œå¿½ç•¥å…¶ä»–è§¦å‘å™¨
     - å‚è€ƒ `machine_suggestion` ä½†ç¡®ä¿åªåŒ…å«ä¸€ä¸ªé”™è¯¯
     - äººå·¥æ£€æŸ¥ç¡®ä¿è‡ªç„¶æ€§
   - **LOW RISK**ï¼šé€šå¸¸ä¿æŒåŸæ ·ï¼Œæˆ–è€…ä»…æ·»åŠ æå…¶è½»å¾®çš„æ”¹åŠ¨ã€‚

3. **å†™å…¥CSV**ï¼š
   ```bash
   echo "{id},{original_query},{final_noisy_query},{answer_ids_source}" >> /home/wlia0047/ar57/wenyu/result/noisy_query/noisy_queries.csv
   ```

### é˜¶æ®µ 4ï¼šå®ŒæˆéªŒè¯

å¤„ç†å®Œæ‰€æœ‰æŸ¥è¯¢åï¼Œè¿›è¡Œä¸€æ¬¡æŠ½æ ·å¯¹æ¯”ï¼š

```bash
paste -d '|' <(cut -d, -f2 clean_queries.csv | head -5) <(cut -d, -f3 noisy_queries.csv | head -5)
```

## ğŸ“‹ ä»»åŠ¡æ¸…å• (Task List)

å¤„ç†æ—¶è¯·ç»´æŠ¤æ­¤æ¸…å•ï¼š

- [ ] 0-10 è¡Œå¤„ç†å®Œæ¯•
- [ ] 11-20 è¡Œå¤„ç†å®Œæ¯•
- [ ] ...
- [ ] å…¨éƒ¨å¤„ç†å®Œæ¯•

## ğŸ’¡ ä½¿ç”¨æç¤º

1. **ğŸ”’ å•é”™è¯¯åŸåˆ™ï¼ˆæœ€é‡è¦ï¼‰**ï¼šæ¯ä¸ªå¥å­åªå…è®¸æ³¨å…¥ä¸€ä¸ªé”™è¯¯ã€‚å³ä½¿è¯†åˆ«å‡ºå¤šä¸ªè§¦å‘å™¨ï¼Œä¹Ÿåªèƒ½åº”ç”¨æƒé‡æœ€é«˜çš„é‚£ä¸€ä¸ªã€‚è¿™æ˜¯ç¡¬æ€§è¦æ±‚ï¼Œä¸å¯è¿åã€‚

2. **æƒé‡æ’åºç­–ç•¥**ï¼šè§¦å‘å™¨æŒ‰æƒé‡é™åºæ’åˆ—ï¼Œä¼˜å…ˆåº”ç”¨é«˜æƒé‡çš„é”™è¯¯ç±»å‹ï¼ˆä½†åªåº”ç”¨ä¸€ä¸ªï¼‰ã€‚

3. **è¿‡æ»¤æœºåˆ¶**ï¼šåªåº”ç”¨æƒé‡ â‰¥ 0.3 çš„è§¦å‘å™¨ï¼Œä½æƒé‡è§¦å‘å™¨ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤ã€‚

4. **ç¡®å®šæ€§è¾“å‡º**ï¼šç›¸åŒçš„æŸ¥è¯¢æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„æ”¹å†™ç»“æœï¼ˆä¸å†ä½¿ç”¨éšæœºæ•°ï¼‰ã€‚

5. **åŠ¨æ€é˜ˆå€¼å½±å“**ï¼š
   - é«˜é”™è¯¯ç‡ç”¨æˆ·ï¼ˆå¦‚ 1.5/100è¯ï¼‰â†’ é˜ˆå€¼é™è‡³ ~0.20 â†’ æ›´å¤šæŸ¥è¯¢è¢«æ ‡è®°ä¸º HIGH RISK
   - ä½é”™è¯¯ç‡ç”¨æˆ·ï¼ˆå¦‚ 0.1/100è¯ï¼‰â†’ é˜ˆå€¼å‡è‡³ ~0.45 â†’ åªæœ‰éƒ¨åˆ†æŸ¥è¯¢è¢«æ ‡è®°
   - å…¸å‹ç”¨æˆ·ï¼ˆå¦‚ 0.45/100è¯ï¼‰â†’ é˜ˆå€¼çº¦ 0.34 â†’ çº¦ 50-60% çš„æŸ¥è¯¢è¢«ä¿®æ”¹

6. **ç´¯ç§¯æ•ˆåº”**ï¼šå¤šä¸ªè§¦å‘å™¨ä¼šç´¯åŠ é£é™©åˆ†æ•°ï¼Œè¶…è¿‡åŠ¨æ€é˜ˆå€¼æ‰ä¼šè¢«æ ‡è®°ä¸º HIGH RISKã€‚

7. **è´¨é‡ä¼˜äºæ•°é‡**ï¼šå®å¯å°‘æ³¨å…¥é”™è¯¯ï¼Œä¹Ÿè¦ç¡®ä¿é”™è¯¯ç¬¦åˆç”¨æˆ·çš„çœŸå®å†™ä½œé£æ ¼ã€‚

## ğŸ› ï¸ æ•…éšœæ’é™¤

**é—®é¢˜**ï¼šè„šæœ¬æç¤ºæ‰¾ä¸åˆ°é”™è¯¯ç»Ÿè®¡æ–‡ä»¶
**è§£å†³**ï¼šç¡®ä¿ `error_stats_{USER_ID}.json` æ–‡ä»¶å­˜åœ¨ä¸”è·¯å¾„æ­£ç¡®

**é—®é¢˜**ï¼šæƒé‡éƒ½æ˜¾ç¤ºä¸ºé»˜è®¤å€¼ 0.30
**è§£å†³**ï¼šæ£€æŸ¥ç»Ÿè®¡æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œåº”è¯¥åŒ…å« `spelling` å’Œ `grammar` å­—æ®µ

**é—®é¢˜**ï¼šç”Ÿæˆçš„å™ªéŸ³è¿‡äºäººå·¥åŒ–
**è§£å†³**ï¼šé™ä½ `GLOBAL_THRESHOLD` å€¼ï¼Œæˆ–åœ¨æ‰‹åŠ¨å¤„ç†æ—¶é€‰æ‹©æ€§åº”ç”¨å»ºè®®

**é—®é¢˜**ï¼šå¦‚ä½•éªŒè¯æ¯ä¸ªå¥å­åªæœ‰ä¸€ä¸ªé”™è¯¯ï¼Ÿ
**è§£å†³**ï¼šä½¿ç”¨ä»¥ä¸‹è„šæœ¬æ£€æŸ¥ï¼š
```bash
python3 << 'EOF'
import csv

with open('noisy_queries.csv', 'r', encoding='utf-8') as f:
    reader = csv.DictReader(f)
    for row in reader:
        if row['original_query'] != row['noisy_query']:
            # æ‰‹åŠ¨æ£€æŸ¥åªæœ‰ä¸€ä¸ªè¯è¢«ä¿®æ”¹
            print(f"ID {row['id']}: {row['noisy_query']}")
EOF
```
